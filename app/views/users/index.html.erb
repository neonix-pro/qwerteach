<%= form_tag users_path, :method => :get do %>
    <p>
      <%= label_tag "Mot-clÃ©" %>
      <%= text_field_tag :q, params[:search] %><br>
      <%= label_tag "Age : " %>
      <%= label_tag "De" %>
      <%= number_field_tag :age_min, params[:age_min], :min => 0 %>
      <%= label_tag "A" %>
      <%= number_field_tag :age_max, params[:age_max], :min => 0  %><br>
      <%= label_tag "Diplome" %>
      <% levels = Level.select('distinct(' + I18n.locale[0..3] + '), id,' + I18n.locale[0..3] + '').where(:code => "scolaire").group(I18n.locale[0..3]).order(:id) %>
      <%= select_tag :degree_id, options_for_select(levels.all.collect { |p| [p[I18n.locale[0..3]], p.id] }), :include_blank => true %>
      <br>
      <%= label_tag "Prix : " %>
      <%= label_tag "De" %>
      <%= number_field_tag :min_price, params[:min_price] , :min => 0 %>
      <%= label_tag "A" %>
      <%= number_field_tag :max_price, params[:max_price], :min => 0  %><br>
      <%= submit_tag "Search", :name => nil %>
    </p>
<% end %>
<div id="facets">
  <h3>Results</h3>
  <% h = Hash.new() %>
  <ul>
    <% @search.results.each do |x| %>
        <% if h.assoc(x.user_id).nil? %>
            <% h.store(x.user_id, Array.new) %>
        <% end %>
        <% h[x.user_id].push(x) %>
    <% end %>
    <% @pagin %>
    <% if params[:degree_id].blank? %>
        <% @pagin = User.where(:id => h.keys, :postulance_accepted => true).order(:level_id).page(params[:page]).per(15) %>
    <% else %>
        <% @pagin = User.where(:id => h.keys, :postulance_accepted => true).where('level_id >= ?', params[:degree_id]).order(:level_id).page(params[:page]).per(15) %>
    <% end %>
    <% #@pagin = Kaminari.paginate_array(@table).page(params[:page]).per(1)                %>
    <% @pagin.each do |u| %>
        <li>
          <p><%= image_tag(u.avatar.url(:small)) %><%= link_to u.email, user_path(u) %></p>
          <% h[u.id].each do |a| %>
              <%= link_to a.topic.title, advert_path(a) %>
          <% end %>
        </li>
    <% end %>
    <%= paginate @pagin %>
  </ul>
</div>

