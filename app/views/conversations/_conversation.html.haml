.mailbox-conversation{:id => "chatbox_#{conversation.id}", data: {id: conversation.id}}
  .loader.text-center
    %i.fa.fa-spinner.fa-spin.fa-3x.text-green
  .conversation-content
    .show-more.text-center
      = link_to 'voir plus', conversation_show_page_path(conversation, page+1), remote:true, data:{toggle:'loader'}
    = render 'conversations/messages', messages: messages
  .conversation-reply
    = form_tag reply_conversation_path(conversation), :remote => true, id: "conversation_form_#{conversation.id}", method: :post do
      = text_area_tag 'body', nil, cols: 3, class: 'form-control chatboxtextarea', placeholder: 'Type something...', required: true, "data-cid" => conversation.id
      = submit_tag "Envoyer", class: 'btn btn-primary'
.mailbox-conversation-details
  .conversation-participants
    -conversation.participants.each do |p|
      = render 'conversations/conversation_participant', user: p unless p == current_user

= subscribe_to reply_conversation_path(conversation)
:javascript
  $('#chatbox_#{conversation.id} .chatboxtextarea').click(function () {
    $.ajax({
      dataType: 'text/html',
      url: "#{mark_as_read_conversation_path(conversation.id)}",
      data: {conversation_id: "#{conversation.id}"},
      method: 'post'
    })
    .always(function(){
      Messages.numberOfUnreadMessages();
    });
  });